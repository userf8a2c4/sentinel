name: Auto-format with Black

on:
  pull_request:
    branches: [dev-v3, main]

permissions:
  contents: write   # ← importante para poder commitear

jobs:
  format:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
      with:
        ref: ${{ github.head_ref }}

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'  # o la versión que uses

    - name: Install Black
      run: pip install black

    - name: Run Black formatter
      id: black
      run: |
        black --diff --color .
        black .

    - name: Commit formatted files (if changed)
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: "style: auto-format with black"
        branch: ${{ github.head_ref }}
        skip_dirty_check: false
        skip_fetch: true
